# IDFA/AdID リストアップロード API 仕様書

## 概要

Zucks AdNetwork の配信でターゲティングとして利用したい IDFA/Android advertising ID (以下 ida) のリストをアップロードするためのAPIです。

Zucks AdNetwork では以下のAPIを提供します

* ida リストのアップロード
* ida リスト更新

## 準備

* Zucks AdNetwork ida リスト用 API キー
  * 不明な場合は Zucks 担当者にご確認ください

## 認証

* 管理画面で確認できる ida リストアップロード API キーをリクエストヘッダに使った認証
  * 将来的にAPIキーは管理画面から再発行、無効化を行えるようにする予定

## リクエスト例

    curl  -X POST <URL> -H "x-api-key:${API_KEY}" -d '<PAYLOAD>'

## idaリストのアップロード

ida のリストをアップロードし、ターゲティングで利用するための準備を行います。
ターゲティングとして利用できるようになるためにはアップロードしてから最大1時間程度掛かります。
ida リストを案件から指定することで配信時のターゲティングとして利用されます。

### URL

    https://ms.zucksadnetwork.com/web_api/ida


  * リクエストメソッド: POST

### PAYLOAD

 * name: アップロードした ida リストの名前 (120文字以内)、リスト名はユニークである必要があります (必須)
 * advertiser_id: ida リストを利用する広告主ID(管理画面から確認できます) (必須)
 * ida: 配列の要素で ida を指定 (必須)

```json
{
  "name": "10日起動していないユーザー_2015-10-30",
  "advertiser_id": 10324,
  "ida":["aaaaaaaa-bbbb-cccc-1111-222222220000","aaaaaaaa-bbbb-cccc-1111-222222220001"]
}
```

### レスポンス

アップロードが成功したかどうかはHTTPのレスポンスのステータスコードが200かどうかで確認できます。
空文字列の場合はその文字列は取り込まずスキップします。
レスポンスのコンテンツはJSONで返却されます。

#### ステータスコード

 * 200: 正常に終了
 * 400: データのバリデーションエラーなどの場合
 * 401: 認証に失敗した場合

#### レスポンス内容

* 成功した場合
  * list_id: 作成されたida リストID、更新時にこのIDを指定することでida リストを更新することができます
  * created_at: リストを作成した日時
  * expired_at: リストの有効最終日時
  * request_at: APIをリクエストされた日時

```json
{
  "list_id": 1,
  "created_at": "2015-04-01T12:00Z",
  "expired_at": "2015-06-01T12:00Z",
  "request_at": "2015-05-01T12:00Z"
}
```

 * 失敗した場合

```json
{
  "error": "既に同名のリスト名が存在します",
  "request_at": "2015-05-01T12:00Z"
}
```

## ida リスト更新

上記で作成したときにレスポンスに含まれる ida リストIDを指定することで、idaリストを新しい内容に更新します。
また、ターゲティングとして利用できるようになるためにはアップロードしてから1時間程度掛かります。
そのため、更新APIを叩いた直後はターゲティングとしてシステムに取り込まれていないため該当案件の配信ボリュームは減少します。

### URL


    https://ms.zucksadnetwork.com/web_api/ida/<更新したいidaリストID>


  * リクエストメソッド: PUT


### PAYLOAD

* list
  * name: アップロードした ida リストの名前 (120文字以内)、リスト名はユニークである必要があります(オプション)
  * ida: 配列の要素で ida を指定(必須)

```json
{
  "name": "10日起動していないユーザー_2015-11-01",
  "ida":["aaaaaaaa-bbbb-cccc-1111-222222220000", "aaaaaaaa-bbbb-cccc-1111-222222220001"]
}
```

### レスポンス

アップロードが成功したかどうかはHTTPのレスポンスのステータスコードが200かどうかで確認できます。
レスポンスのコンテンツはJSONで返却されます。

#### ステータスコード

 * 200: 正常に終了
 * 400: データのバリデーションエラーなどの場合
 * 401: 認証に失敗した場合

#### レスポンス内容

 * 成功した場合
  * list_id: 作成されたida リストID、更新時にこのIDを指定することでida リストを更新することができます
  * created_at: リストを作成した日時
  * expired_at: リストの有効最終日時
  * request_at: APIをリクエストされた日時

```json
{
  "list_id": "<作成されたidaリストのID>",
  "created_at": "2015-04-01T12:00Z",
  "expired_at": "2015-06-01T12:00Z",
  "request_at": "2015-05-01T12:00Z"
}
```

 * 失敗した場合

```json
{
  "error": "指定されたidaリストのIDが存在しません",
  "request_at": "2015-05-01T12:00Z"
}
```
